#= depend_on_asset "search.html"
#= depend_on_asset "movie.html"

window.movieSearch = angular.module('movieSearch', ['ngRoute', 'movieSearch.controllers'])

.constant("MOVIE_API", "http://www.omdbapi.com/?")

.config(['$routeProvider', ($routeProvider)->
  $routeProvider
    .when('/movies/:id', {
      templateUrl: '<%= asset_path("movie.html") %>'
      controller: 'MovieShowCtrl',
      resolve: {
        movie: ['$route', '$q', 'MOVIE_API', '$http', ($route, $q, MOVIE_API, $http)->
            deferred = $q.defer();
            $http.get(MOVIE_API+"i="+$route.current.params.id).success( (data) ->
              deferred.resolve(data)
              console.log('Successfully loaded movie.')
            ).error( ->
              deferred.reject()
              console.error('Failed to load movie.')
              #bonus show in UI
            )
            
            return deferred.promise
        ]
      }
    })
    .otherwise({
      templateUrl: '<%= asset_path("search.html") %>',
      controller: 'SearchCtrl'
    })
])